{"version":3,"file":"context.js","sources":["../../src/libs/context.tsx"],"sourcesContent":["/**\n * Declarative context creation for Proto apps.\n * Generates Provider and hook with full typing, optional Immer integration.\n */\n\nimport { createContext, useContext, useCallback, useState, type ReactNode, type Dispatch, type SetStateAction } from 'react'\nimport type { Draft } from 'immer'\n\nexport interface CreateProtoContextOptions<T> {\n  name: string\n  initialState: T\n  useImmer?: boolean\n}\n\nexport interface ProtoContextValue<T> {\n  state: T\n  setState: Dispatch<SetStateAction<T>>\n  update: (fn: (draft: T | Draft<T>) => void) => void\n}\n\nexport function createProtoContext<T>(options: CreateProtoContextOptions<T>) {\n  const { name, initialState, useImmer = false } = options\n  const Ctx = createContext<ProtoContextValue<T> | null>(null)\n\n  function useValue(): ProtoContextValue<T> {\n    const ctx = useContext(Ctx)\n    if (!ctx) throw new Error(`${name} must be used within its Provider`)\n    return ctx\n  }\n\n  function Provider(props: { children: ReactNode }) {\n    const [state, setState] = useState<T>(initialState)\n    const update = useCallback(\n      (fn: (draft: T | Draft<T>) => void) => {\n        if (useImmer) {\n          import('immer').then(({ produce }) => {\n            setState((prev) => produce(prev, fn as (draft: Draft<T>) => void))\n          })\n        } else {\n          setState((prev) => {\n            const next = typeof prev === 'object' && prev !== null ? ({ ...(prev as object) } as T) : prev\n            ;(fn as (draft: T) => void)(next)\n            return next\n          })\n        }\n      },\n      [useImmer],\n    )\n    return <Ctx.Provider value={{ state, setState, update }}>{props.children}</Ctx.Provider>\n  }\n\n  return { Provider, useValue }\n}\n"],"names":[],"mappings":";;AAoBO,SAAS,mBAAsB,SAAuC;AAC3E,QAAM,EAAE,MAAM,cAAc,WAAW,UAAU;AACjD,QAAM,MAAM,cAA2C,IAAI;AAE3D,WAAS,WAAiC;AACxC,UAAM,MAAM,WAAW,GAAG;AAC1B,QAAI,CAAC,IAAK,OAAM,IAAI,MAAM,GAAG,IAAI,mCAAmC;AACpE,WAAO;AAAA,EACT;AAEA,WAAS,SAAS,OAAgC;AAChD,UAAM,CAAC,OAAO,QAAQ,IAAI,SAAY,YAAY;AAClD,UAAM,SAAS;AAAA,MACb,CAAC,OAAsC;AACrC,YAAI,UAAU;AACZ,iBAAO,OAAO,EAAE,KAAK,CAAC,EAAE,cAAc;AACpC,qBAAS,CAAC,SAAS,QAAQ,MAAM,EAA+B,CAAC;AAAA,UACnE,CAAC;AAAA,QACH,OAAO;AACL,mBAAS,CAAC,SAAS;AACjB,kBAAM,OAAO,OAAO,SAAS,YAAY,SAAS,OAAQ,EAAE,GAAI,KAAA,IAA0B;AACxF,eAA0B,IAAI;AAChC,mBAAO;AAAA,UACT,CAAC;AAAA,QACH;AAAA,MACF;AAAA,MACA,CAAC,QAAQ;AAAA,IAAA;AAEX,WAAO,oBAAC,IAAI,UAAJ,EAAa,OAAO,EAAE,OAAO,UAAU,OAAA,GAAW,UAAA,MAAM,SAAA,CAAS;AAAA,EAC3E;AAEA,SAAO,EAAE,UAAU,SAAA;AACrB;"}