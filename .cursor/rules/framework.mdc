---
description: Protobox framework development - architecture, build isolation, CLI, libs, preview
globs: src/**/*, vite*.config.ts, package.json
alwaysApply: false
---

# Protobox Framework Development

## Architecture

- **CLI** (`src/cli.ts`, `src/commands/`): Node-only, no React. Must not import libs or preview.
- **Libs** (`src/libs/`): Tree-shakable utilities. No CLI or preview imports.
- **Preview** (`src/preview/`): React app. Loads built apps only via iframe; never imports project code.

## Build Isolation

- Each target builds separately: `build:cli`, `build:libs`, `build:preview`.
- Libs entry points are auto-discovered from `src/libs/*.{ts,tsx}`. Adding a new file there is enough — no config changes needed. Importable as `protobox/<name>`.

## Patterns

- **Declarative over imperative**: Parameters, context use declarative APIs.
- **Minimal dependencies**: Avoid heavy state libs; Immer is optional via `useImmer`.
- **Simple patterns**: No magic, predictable resolution, readable to LLMs.

## CLI Commands

- `init`, `build`, `watch`, `run`, `add` — one file per command.
- Lazy-load only when needed; avoid pulling unused modules at startup.

## Extension Points

- Add preset templates in `templates/presets/*.txt` with `{{NAME}}`, `{{NAMEPASCAL}}`.
- Extend libs by adding a new `.ts`/`.tsx` file under `src/libs/` — it becomes an entry point automatically. Re-export from `index.ts` if it should be available via the `protobox` barrel import.
